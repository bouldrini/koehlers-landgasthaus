function Tabulatr(t){this.id=t,this.name="",this.moreResults=!0,this.currentData=null,this.locked=!1}var tabulatr_tables;Tabulatr.prototype={constructor:Tabulatr,createPaginationListItem:function(t,a){var e=$('<li><a href="" data-page="'+t+'">'+t+"</a></li>");return a&&e.addClass("active"),e},updatePagination:function(t,a){var e=$(".pagination[data-table="+this.id+"] > ul");if(e.html(""),13>a)for(var i=1;a>=i;i++)e.append(this.createPaginationListItem(i,i==t));else{t>1&&e.append(this.createPaginationListItem(1,!1));var r=Math.floor((1+t)/2);r>1&&t-2>r&&(e.append("<li><span>...</span></li>"),e.append(this.createPaginationListItem(r,!1))),t>4&&e.append("<li><span>...</span></li>"),t>3&&(e.append(this.createPaginationListItem(t-2,!1)),e.append(this.createPaginationListItem(t-1,!1))),e.append(this.createPaginationListItem(t,!0)),a-1>t&&e.append(this.createPaginationListItem(t+1,!1)),a-2>t&&e.append(this.createPaginationListItem(t+2,!1)),a-3>t&&e.append("<li><span>...</span></li>"),r=Math.floor((t+a)/2),r>t+3&&a-1>r&&(e.append(this.createPaginationListItem(r,!1)),e.append("<li><span>...</span></li>")),a>t&&e.append(this.createPaginationListItem(a,!1))}},updateTable:function(t,a){var e=$("#"+this.id);if(void 0===t.page||a)this.storePage=!1;else if(this.storePage=!0,e.find("tbody tr").hide(),e.find("tbody tr[data-page="+t.page+"]").length>0)return e.find("tbody tr[data-page="+t.page+"]").show(),this.updatePagination(t.page,$(".pagination[data-table="+this.id+"] a:last").data("page"),this.id),void 0;if(!this.locked){this.locked=!0;this.showLoadingSpinner(),$.ajax({context:this,type:"GET",url:$("table#"+this.id).data("path"),contentType:"application/json",data:this.createParameterString(t,this.id),success:this.handleResponse,complete:this.hideLoadingSpinner})}},checkIfCheckboxesAreMarked:function(){return $("tr[data-page] input[type=checkbox]:checked").length>0},currentCount:function(){return $("#"+this.id+" tbody tr.tabulatr-row").length},handleResponse:function(t){this.insertTabulatrData(t),this.updatePagination(t.meta.page,t.meta.pages,t.meta.table_id),this.locked=!1},insertTabulatrData:function(t){var a=t.meta.table_id,e=$("#"+a+" tbody");if(t.meta.append||(this.storePage?$("#"+a+" tbody tr").hide():$("#"+a+" tbody").html("")),0===t.data.length)this.moreResults=!1,$(".pagination_trigger[data-table="+a+"]").unbind("inview");else{this.currentCount()+t.data.length>=t.meta.count&&(this.moreResults=!1,$(".pagination_trigger[data-table="+a+"]").unbind("inview"));for(var i=0;i<t.data.length;i++){var r=t.data[i],n=r.id,l=$("tr.empty_row").clone();l.removeClass("empty_row"),r._row_config.data&&(l.data(r._row_config.data),delete r._row_config.data),l.attr(r._row_config),l.attr("data-page",t.meta.page),l.attr("data-id",n),l.find("td").each(function(t,a){var e=$(a),i=e.data("tabulatr-type"),l=e.data("tabulatr-column-name"),d=r[l];"checkbox"===i&&(d=$("<input>").attr("type","checkbox").val(n).addClass("tabulatr-checkbox")),e.html(d)}),e.append(l)}}var d=$(".tabulatr_count[data-table="+a+"]").data("format-string");d=d.replace(/%\{current\}/,t.meta.count),d=d.replace(/%\{total\}/,t.meta.total),d=d.replace(/%\{per_page\}/,t.meta.pagesize),$(".tabulatr_count[data-table="+a+"]").html(d)},replacer:function(t,a){return this.currentData[a]},makeAction:function(t,a){return this.currentData=a,unescape(t).replace(/{{([\w:]+)}}/g,this.replacer)},submitFilterForm:function(){return 0===$(".pagination[data-table="+this.id+"]").length&&($(".pagination_trigger[data-table="+this.id+"]").unbind("inview",cbfn),$(".pagination_trigger[data-table="+this.id+"]").bind("inview",cbfn)),this.updateTable({page:1,append:!1},!0),!1},createParameterString:function(t){var a=this.id.split("_")[0];void 0===t&&(t={},t.append=!1);var e=t.pagesize;void 0===e&&(e=$("table#"+this.id).data("pagesize")),void 0===t.page&&(t.page=Math.floor($("#"+this.id+" tbody tr[class!=empty_row]").length/e)+1,isFinite(t.page)||(t.page=1)),t.pagesize=e,t.arguments=$.map($("#"+this.id+" th"),function(t){return $(t).data("tabulatr-column-name")}).filter(function(t){return t}).join(),t.table_id=this.id,t[a+"_search"]=$("input#"+a+"_fuzzy_search_query").val();for(var i=$('.tabulatr_filter_form[data-table="'+this.id+'"]').find("input:visible,select:visible,input[type=hidden]").serializeArray(),r=0;r<i.length;r++)t[i[r].name]=i[r].value;return t},localDate:function(t){return new Date(t).toLocaleString()},showLoadingSpinner:function(){$(".tabulatr-spinner-box[data-table="+this.id+"]").show()},hideLoadingSpinner:function(){$(".tabulatr-spinner-box[data-table="+this.id+"]").hide()}},$(document).on("ready page:load",function(){if(tabulatr_tables=[],$("th.tabulatr-sortable").click(function(){for(var t=$(this),a=t.data("tabulatr-column-name"),e=t.attr("data-sorted"),i=t.parents("table"),r=i.attr("id"),n=void 0,l=0;l<tabulatr_tables.length;l++)tabulatr_tables[l].id==r&&(n=tabulatr_tables[l]);var d=n.id.split("_")[0];i.find("th.tabulatr-sortable.sorted").removeClass("sorted").removeAttr("data-sorted"),e="asc"===e?"desc":"asc",t.addClass("sorted").attr("data-sorted",e),$(".tabulatr_filter_form[data-table="+r+"] input[name="+d+"_sort]").val(a+" "+e),n.moreResults||(n.moreResults=!0,0===$(".pagination[data-table="+r+"]").length&&$(".pagination_trigger[data-table="+r+"]").bind("inview",cbfn)),$($(this).parents("table").find("tbody tr")).remove(),$(".tabulatr_mark_all[data-table="+d+"]").prop("checked",!1).prop("indeterminate",!1),n.updateTable({})}),$(".tabulatr_table").each(function(t,a){0===$('.pagination[data-table="'+$(a).attr("id")+'"]').length&&$('.pagination_trigger[data-table="'+$(a).attr("id")+'"]').bind("inview",cbfn)}),$(".batch-action-inputs").click(function(){var t=$(this),a=t.data("do-batch-action-name"),e=t.data("do-batch-action"),i=t.data("table-id"),r={page:1};r[a]=e,r.tabulatr_checked={checked_ids:jQuery.map($("#"+i+" .tabulatr-checkbox:checked"),function(t){return $(t).val()}).join(",")},$(".tabulatr_mark_all[data-table="+i+"]").prop("indeterminate",!1).prop("checked",!1),$("#"+i+" .tabulatr-wrench").addClass("disabled");for(var n=void 0,l=0;l<tabulatr_tables.length;l++)tabulatr_tables[l].id==i&&(n=tabulatr_tables[l]);n.updateTable(r,!0)}),$("form.tabulatr-fuzzy-search").submit(function(){var t=$(this).data("table");0===$(".pagination[data-table="+t+"]").length&&($(".pagination_trigger[data-table="+t+"]").unbind("inview",cbfn),$(".pagination_trigger[data-table="+t+"]").bind("inview",cbfn));for(var a=void 0,e=0;e<tabulatr_tables.length;e++)tabulatr_tables[e].id==t&&(a=tabulatr_tables[e]);return a.updateTable({page:1,append:!1},!0),!1}),$("form.tabulatr_filter_form").submit(function(){for(var t=$(this).data("table"),a=void 0,e=0;e<tabulatr_tables.length;e++)tabulatr_tables[e].id==t&&(a=tabulatr_tables[e]);return a.submitFilterForm(),!1}),$(".tabulatr_table").on("click","i.tabulatr_remove_filter",function(){var t=$(this).closest("th"),a=t.data("tabulatr-form-name").replace(/\[(like|checkbox|from|to)\]/,"");a=a.replace(/(:|\.|\[|\])/g,"\\$1"),t.removeClass("tabulatr_filtered_column"),$("[name^="+a+"]").is(":checkbox")?$("[name^="+a+"]").prop("checked",!1):$("[name^="+a+"]").val("");var e=$(this).closest(".tabulatr_table").attr("id");$(this).remove(),0===$(".pagination[data-table="+e+"]").length&&$(".pagination_trigger[data-table="+e+"]").bind("inview",cbfn);for(var i=void 0,r=0;r<tabulatr_tables.length;r++)tabulatr_tables[r].id==e&&(i=tabulatr_tables[r]);return i.updateTable({}),!1}),$(".tabulatr_mark_all").click(function(){for(var t=$(this).parents("table").prop("id"),a=void 0,e=0;e<tabulatr_tables.length;e++)tabulatr_tables[e].id==t&&(a=tabulatr_tables[e]);$(this).is(":checked")?($("#"+t+" tr[data-page]:visible input[type=checkbox]").prop("checked",!0),$("#"+t+" .tabulatr-wrench").removeClass("disabled")):($("#"+t+" tr[data-page]:visible input[type=checkbox]").prop("checked",!1),a.checkIfCheckboxesAreMarked()?$("#"+t+" .tabulatr-wrench").removeClass("disabled"):$("#"+t+" .tabulatr-wrench").addClass("disabled"))}),$(".tabulatr_table").on("click","input.tabulatr-checkbox",function(){for(var t=$(this).closest(".tabulatr_table"),a=t.attr("id"),e=t.find(".tabulatr_mark_all"),i=void 0,r=0;r<tabulatr_tables.length;r++)tabulatr_tables[r].id==a&&(i=tabulatr_tables[r]);$(this).is(":checked")?($("#"+a+" tr[data-page]:visible input[type=checkbox]").not(":checked").length>0?e.prop("indeterminate",!0):(e.prop("indeterminate",!1),e.prop("checked",!0)),$("#"+a+" .tabulatr-wrench").removeClass("disabled")):$("#"+a+" tr[data-page]:visible input[type=checkbox]:checked").length>0?(e.prop("indeterminate",!0),$("#"+a+" .tabulatr-wrench").removeClass("disabled")):(e.prop("indeterminate",!1),e.prop("checked",!1),i.checkIfCheckboxesAreMarked()?$("#"+a+" .tabulatr-wrench").removeClass("disabled"):$("#"+a+" .tabulatr-wrench").addClass("disabled"))}),$(".tabulatr-per-page a").click(function(){if($(this).hasClass("active"))return!1;$(this).closest("div").find("a").removeClass("active"),$(this).addClass("active");for(var t=$(this).closest("div").data("table"),a=void 0,e=0;e<tabulatr_tables.length;e++)tabulatr_tables[e].id==t&&(a=tabulatr_tables[e]);a.moreResults=!0,0===$(".pagination[data-table="+t+"]").length&&$(".pagination_trigger[data-table="+t+"]").bind("inview",cbfn),void 0!==typeof Storage&&(localStorage.tabulatr_page_display_count=$(this).data("items-per-page")),a.updateTable({page:1},!0)}),$('.tabulatr_table:not(".tabulatr_static_table")').length>0){if(void 0!==typeof Storage){var t=localStorage.tabulatr_page_display_count;void 0!==t&&($(".tabulatr-per-page a").removeClass("active"),$(".tabulatr-per-page a[data-items-per-page="+t+"]").addClass("active"))}var a=void 0;$('.tabulatr_table:not(".tabulatr_static_table")').each(function(t,e){var i=$(e).attr("id");tabulatr_tables.push(new Tabulatr(i));for(var r=0;r<tabulatr_tables.length;r++)tabulatr_tables[r].id==i&&(a=tabulatr_tables[r]);a.updateTable({})})}}),$(document).on("click",".pagination a",function(){var t=$(this);if(t.parent().hasClass("active")||t.parent().hasClass("disabled"))return!1;var a=$(t).closest(".pagination").data("table");$(".tabulatr_mark_all[data-table="+a+"]").prop("checked",!1),$(".tabulatr_mark_all[data-table="+a+"]").prop("indeterminate",!1);for(var e=void 0,i=0;i<tabulatr_tables.length;i++)tabulatr_tables[i].id==a&&(e=tabulatr_tables[i]);return e.updateTable({append:!1,page:t.data("page")}),!1}),$(document).on("click","a[data-show-table-filter]",function(){var t=$(this),a=t.data("show-table-filter");return $('div[data-filter-column-name="'+a+'"]').show("blind"),$('div[data-filter-column-name="_submit"]').show("blind"),t.hide(),!1}),$(document).on("click","a[data-hide-table-filter]",function(){var t=$(this),a=t.data("hide-table-filter"),e=$('div[data-filter-column-name="'+a+'"]');e.hide("blind"),e.find("input[type=text]").val(""),$('a[data-show-table-filter="'+a+'"]').show(),$("div[data-filter-column-name]:visible").length<=2&&$('div[data-filter-column-name="_submit"]').hide("blind");for(var i=$(this).parents("form").data("table"),r=void 0,n=0;n<tabulatr_tables.length;n++)tabulatr_tables[n].id==i&&(r=tabulatr_tables[n]);return r.submitFilterForm(),!1}),$(document).on("change","select[data-tabulatr-date-filter]",function(){var t=$(this),a=t.find("option:selected"),e=a.val();"from_to"===e?t.parents(".controls").find(".from_to").show().removeClass("hidden"):t.parents(".controls").find(".from_to").hide().val("")});var cbfn=function(t,a,e,i){if(a)if("top"==i);else if("bottom"==i);else{for(var r=$(t.currentTarget).data("table"),n=void 0,l=0;l<tabulatr_tables.length;l++)tabulatr_tables[l].id==r&&(n=tabulatr_tables[l]);n.updateTable({append:!0})}};