Tabulatr={moreResults:!0,storePage:!1,currentData:null,locked:!1,createPaginationListItem:function(a,t){var e=$('<li><a href="" data-page="'+a+'">'+a+"</a></li>");return t&&e.addClass("active"),e},updatePagination:function(a,t,e){var r=$(".pagination[data-table="+e+"] > ul");if(r.html(""),13>t)for(var i=1;t>=i;i++)r.append(Tabulatr.createPaginationListItem(i,i==a));else{a>1&&r.append(Tabulatr.createPaginationListItem(1,!1));var l=Math.floor((1+a)/2);l>1&&a-2>l&&(r.append("<li><span>...</span></li>"),r.append(Tabulatr.createPaginationListItem(l,!1))),a>4&&r.append("<li><span>...</span></li>"),a>3&&(r.append(Tabulatr.createPaginationListItem(a-2,!1)),r.append(Tabulatr.createPaginationListItem(a-1,!1))),r.append(Tabulatr.createPaginationListItem(a,!0)),t-1>a&&r.append(Tabulatr.createPaginationListItem(a+1,!1)),t-2>a&&r.append(Tabulatr.createPaginationListItem(a+2,!1)),t-3>a&&r.append("<li><span>...</span></li>"),l=Math.floor((a+t)/2),l>a+3&&t-1>l&&(r.append(Tabulatr.createPaginationListItem(l,!1)),r.append("<li><span>...</span></li>")),t>a&&r.append(Tabulatr.createPaginationListItem(t,!1))}},updateTable:function(a,t,e){var r=$("#"+t);if(void 0===a.page||e)Tabulatr.storePage=!1;else if(Tabulatr.storePage=!0,r.find("tbody tr[data-page="+a.page+"]").length>0)return r.find("tbody tr").hide(),r.find("tbody tr[data-page="+a.page+"]").show(),Tabulatr.updatePagination(a.page,$(".pagination[data-table="+t+"] a:last").data("page"),t),void 0;Tabulatr.locked||(Tabulatr.locked=!0,jQuery.get($("table#"+t).data("path")+".json",Tabulatr.createParameterString(a,t),Tabulatr.handleResponse))},checkIfCheckboxesAreMarked:function(){return $("tr[data-page] input[type=checkbox]:checked").length>0},handleResponse:function(a){Tabulatr.insertTabulatrData(a),Tabulatr.updatePagination(a.meta.page,a.meta.pages,a.meta.table_id),Tabulatr.locked=!1},insertTabulatrData:function(a){var t=a.meta.table_id,e=$("#"+t+" tbody");if(a.meta.append||(Tabulatr.storePage?$("#"+t+" tbody tr").hide():$("#"+t+" tbody").html("")),0===a.data.length)Tabulatr.moreResults=!1,$(".pagination_trigger[data-table="+t+"]").unbind("inview");else{a.data.length<a.meta.pagesize?(Tabulatr.moreResults=!1,$(".pagination_trigger[data-table="+t+"]").unbind("inview")):Tabulatr.moreResults=!0;for(var r=0;r<a.data.length;r++){var i=a.data[r],l=i.id,n=$("tr.empty_row").clone();n.removeClass("empty_row"),i._row_config.data&&(n.data(i._row_config.data),delete i._row_config.data),n.attr(i._row_config),n.attr("data-page",a.meta.page),n.attr("data-id",l),n.find("td").each(function(a,t){var e=$(t),r=e.data("tabulatr-type"),n=e.data("tabulatr-column-name"),d=i[n];"checkbox"===r&&(d=$("<input>").attr("type","checkbox").val(l).addClass("tabulatr-checkbox")),e.html(d)}),e.append(n)}}var d=$(".tabulatr_count[data-table="+t+"]").data("format-string");d=d.replace(/%\{current\}/,a.meta.count),d=d.replace(/%\{total\}/,a.meta.total),d=d.replace(/%\{per_page\}/,a.meta.pagesize),$(".tabulatr_count[data-table="+t+"]").html(d)},replacer:function(a,t){return Tabulatr.currentData[t]},makeAction:function(a,t){return Tabulatr.currentData=t,unescape(a).replace(/{{([\w:]+)}}/g,Tabulatr.replacer)},submitFilterForm:function(a){return 0===$(".pagination[data-table="+a+"]").length&&($(".pagination_trigger[data-table="+a+"]").unbind("inview",cbfn),$(".pagination_trigger[data-table="+a+"]").bind("inview",cbfn)),Tabulatr.updateTable({page:1,append:!1},a,!0),!1},createParameterString:function(a,t){var e=t.split("_")[0];void 0===a&&(a={},a.append=!1);var r=a.pagesize;void 0===r&&(r=$("table#"+t).data("pagesize")),void 0===a.page&&(a.page=Math.floor($("#"+t+" tbody tr[class!=empty_row]").length/r)+1,isFinite(a.page)||(a.page=1)),a.pagesize=r,a.arguments=$.map($("#"+t+" th"),function(a){return $(a).data("tabulatr-column-name")}).filter(function(a){return a}).join(),a.table_id=t,a[e+"_search"]=$("input#"+e+"_fuzzy_search_query").val();for(var i=$('.tabulatr_filter_form[data-table="'+t+'"]').find("input:visible,select:visible,input[type=hidden]").serializeArray(),l=0;l<i.length;l++)a[i[l].name]=i[l].value;return a},localDate:function(a){return new Date(a).toLocaleString()}},$(document).on("ready page:load",function(){if($("th.tabulatr-sortable").click(function(){var a=$(this),t=a.data("tabulatr-column-name"),e=a.attr("data-sorted"),r=a.parents("table"),i=r.attr("id"),l=i.split("_")[0];r.find("th.tabulatr-sortable.sorted").removeClass("sorted").removeAttr("data-sorted"),e="asc"===e?"desc":"asc",a.addClass("sorted").attr("data-sorted",e),$(".tabulatr_filter_form[data-table="+i+"] input[name="+l+"_sort]").val(t+" "+e),Tabulatr.moreResults||(Tabulatr.moreResults=!0,0===$(".pagination[data-table="+i+"]").length&&$(".pagination_trigger[data-table="+i+"]").bind("inview",cbfn)),$($(this).parents("table").find("tbody tr")).remove(),$(".tabulatr_mark_all[data-table="+l+"]").prop("checked",!1).prop("indeterminate",!1),Tabulatr.updateTable({},i)}),$(".tabulatr_table").each(function(a,t){0===$('.pagination[data-table="'+$(t).attr("id")+'"]').length&&$('.pagination_trigger[data-table="'+$(t).attr("id")+'"]').bind("inview",cbfn)}),$(".batch-action-inputs").click(function(){var a=$(this),t=a.data("do-batch-action-name"),e=a.data("do-batch-action"),r=a.data("table-id"),i={page:1};i[t]=e,i.tabulatr_checked={checked_ids:jQuery.map($("#"+r+" .tabulatr-checkbox:checked"),function(a){return $(a).val()}).join(",")},$(".tabulatr_mark_all[data-table="+r+"]").prop("indeterminate",!1).prop("checked",!1),$("#"+r+" .tabulatr-wrench").addClass("disabled"),Tabulatr.updateTable(i,r,!0)}),$("form.tabulatr-fuzzy-search").submit(function(){var a=$(this).data("table");return 0===$(".pagination[data-table="+a+"]").length&&($(".pagination_trigger[data-table="+a+"]").unbind("inview",cbfn),$(".pagination_trigger[data-table="+a+"]").bind("inview",cbfn)),Tabulatr.updateTable({page:1,append:!1},a,!0),!1}),$("form.tabulatr_filter_form").submit(function(){var a=$(this).data("table");return Tabulatr.submitFilterForm(a),!1}),$(".tabulatr_table").on("click","i.tabulatr_remove_filter",function(){var a=$(this).closest("th"),t=a.data("tabulatr-form-name").replace(/\[(like|checkbox|from|to)\]/,"");t=t.replace(/(:|\.|\[|\])/g,"\\$1"),a.removeClass("tabulatr_filtered_column"),$("[name^="+t+"]").is(":checkbox")?$("[name^="+t+"]").prop("checked",!1):$("[name^="+t+"]").val("");var e=$(this).closest(".tabulatr_table").attr("id");return $(this).remove(),0===$(".pagination[data-table="+e+"]").length&&$(".pagination_trigger[data-table="+e+"]").bind("inview",cbfn),Tabulatr.updateTable({},e),!1}),$(".tabulatr_mark_all").click(function(){var a=$(this).data("table");$(this).is(":checked")?($("#"+a+" tr[data-page]:visible input[type=checkbox]").prop("checked",!0),$("#"+a+" .tabulatr-wrench").removeClass("disabled")):($("#"+a+" tr[data-page]:visible input[type=checkbox]").prop("checked",!1),Tabulatr.checkIfCheckboxesAreMarked()?$("#"+a+" .tabulatr-wrench").removeClass("disabled"):$("#"+a+" .tabulatr-wrench").addClass("disabled"))}),$(".tabulatr_table").on("click","input.tabulatr-checkbox",function(){var a=$(this).closest(".tabulatr_table").attr("id");$(this).is(":checked")?($("#"+a+" tr[data-page]:visible input[type=checkbox]").not(":checked").length>0?$(".tabulatr_mark_all[data-table="+a+"]").prop("indeterminate",!0):($(".tabulatr_mark_all[data-table="+a+"]").prop("indeterminate",!1),$(".tabulatr_mark_all[data-table="+a+"]").prop("checked",!0)),$("#"+a+" .tabulatr-wrench").removeClass("disabled")):$("#"+a+" tr[data-page]:visible input[type=checkbox]:checked").length>0?($(".tabulatr_mark_all[data-table="+a+"]").prop("indeterminate",!0),$("#"+a+" .tabulatr-wrench").removeClass("disabled")):($(".tabulatr_mark_all[data-table="+a+"]").prop("indeterminate",!1),$(".tabulatr_mark_all[data-table="+a+"]").prop("checked",!1),Tabulatr.checkIfCheckboxesAreMarked()?$("#"+a+" .tabulatr-wrench").removeClass("disabled"):$("#"+a+" .tabulatr-wrench").addClass("disabled"))}),$(".tabulatr-per-page a").click(function(){if($(this).hasClass("active"))return!1;$(this).closest("div").find("a").removeClass("active"),$(this).addClass("active");var a=$(this).closest("div").data("table");Tabulatr.moreResults=!0,0===$(".pagination[data-table="+a+"]").length&&$(".pagination_trigger[data-table="+a+"]").bind("inview",cbfn),void 0!==typeof Storage&&(localStorage.tabulatr_page_display_count=$(this).data("items-per-page")),Tabulatr.updateTable({page:1},a,!0)}),$('.tabulatr_table:not(".tabulatr_static_table")').length>0){if(void 0!==typeof Storage){var a=localStorage.tabulatr_page_display_count;void 0!==a&&($(".tabulatr-per-page a").removeClass("active"),$(".tabulatr-per-page a[data-items-per-page="+a+"]").addClass("active"))}$('.tabulatr_table:not(".tabulatr_static_table")').each(function(a,t){Tabulatr.updateTable({},$(t).attr("id"))})}}),$(document).on("click",".pagination a",function(){var a=$(this);if(!a.parent().hasClass("active")&&!a.parent().hasClass("disabled")){var t=$(a).closest(".pagination").data("table");return $(".tabulatr_mark_all[data-table="+t+"]").prop("checked",!1),$(".tabulatr_mark_all[data-table="+t+"]").prop("indeterminate",!1),Tabulatr.updateTable({append:!1,page:a.data("page")},t),!1}}),$(document).on("click","a[data-show-table-filter]",function(){var a=$(this),t=a.data("show-table-filter");return $('div[data-filter-column-name="'+t+'"]').show("blind"),$('div[data-filter-column-name="_submit"]').show("blind"),a.hide(),!1}),$(document).on("click","a[data-hide-table-filter]",function(){var a=$(this),t=a.data("hide-table-filter"),e=$('div[data-filter-column-name="'+t+'"]');e.hide("blind"),e.find("input[type=text]").val(""),$('a[data-show-table-filter="'+t+'"]').show(),$("div[data-filter-column-name]:visible").length<=2&&$('div[data-filter-column-name="_submit"]').hide("blind");var r=$(this).parents("form").data("table");return Tabulatr.submitFilterForm(r),!1}),$(document).on("change","select[data-tabulatr-date-filter]",function(){var a=$(this),t=a.find("option:selected"),e=t.val();"from_to"===e?a.parents(".controls").find(".from_to").show().removeClass("hidden"):a.parents(".controls").find(".from_to").hide().val("")});var cbfn=function(a,t,e,r){t&&("top"==r||"bottom"==r||Tabulatr.updateTable({append:!0},$(a.currentTarget).data("table")))};